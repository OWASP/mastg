## <a name="OMTG-DATAST-001"></a>OMTG-DATAST-001: Test Sensitive Data Storage

### White-box Testing

(Describe how to assess this with access to the source code and build configuration)

### Black-box Testing

[Describe how to test for this issue using static and dynamic analysis techniques. This can include everything from simply monitoring aspects of the app’s behavior to code injection, debugging, instrumentation, etc. ]

### Remediation

[Describe the best practices that developers should follow to prevent this issue]

### References

- [link to relevant how-tos, papers, etc.]

## <a name="OMTG-DATAST-002"></a>OMTG-DATAST-002: Test for Sensitive Data Disclosure in Log Files

### White-box Testing

Check the source code for usage of Logging functions. 

1. Decompile the APK to get access to the Java source code as described in <link to guide>
2. Import the Java files in an IDE (e.g. IntelliJ or Eclipse) or Editor of your choice or directly open them in JD-Gui, ClassyShark or use grep on the command line to search for
- functions like:
  - Logger
  - Log.d, Log.e, Log.i, Log.v. Log.w or Log.wtf
  - System.out.print|System.out.println
  - StrictMode
- Keywords (to identify non-standard log mechanisms) like :
  - Logfile
  - logging


### Black-box Testing

In order to test the log output, the App should be in Debug Mode. If that’s not the case the App should be repackaged with the debuggable flag activated. See the following steps for more details on how to do it.

1. Use apktool to restore AndroidManifest.xml: 

```
$ apktool d --no-src target_app.apk
```

 
2. Add android:debuggable = “true” to the manifest:
<application android:allowBackup="true" android:debuggable="true" android:icon="@drawable/ic_launcher" android:label="@string/app_name" android:name="com.xxx.xxx.xxx" android:theme="@style/AppTheme">
 
3. Repack and sign the APK:

```
$ apktool b 
$ zipalign -v 4  target_app.recompiled.apk  target_app.recompiled.aligned.apk
$ keytool -genkey -v -keystore ~/.android/debug.keystore -alias signkey -keyalg RSA -keysize 2048 -validity 20000
$ jarsigner -verbose -keystore ~/.android/debug.keystore  target_app.recompiled.aligned.apk signkey
```
 
4. Reinstall the app:

```
$ adb install  target_app.recompiled.aligned.apk
```

By using XInstaller an App can also be made debuggable dynamically, see also http://repo.xposed.info/module/com.pyler.xinstaller.

1. Check if log data is generated when starting, using and closing the app by checking application logs, as some mobile applications create and store their own logs. Identify the data directory of the application in /data/data/<package-name> to look for log files. 
2. Many application developers use still System.out.println() or printStackTrace() instead of a proper logging class. Therefore the testing approach also needs to cover all output generated by the application during starting, running and closing of it and not only the output created by the log classes. In order to verify what data is written to logfiles and printed directly by using System.out.println() or printStackTrace() the code should be checked for these functions and the tool LogCat can be used to check the output. Two different approaches are available to execute LogCat. 

- LogCat can be executed by using adb in order to store the log output permanently. 

```
adb logcat > logcat.log
```

- LogCat is already part of Dalvik Debug Monitor Server (DDMS) and is therefore built into Android Studio. Once the app is running and in debug mode, patterns can be defined in LogCat to reduce the log output of the app.


### Remediation

Ensure logging statements are removed from the production release, as logs may be interrogated or readable by other applications. Tools like ProGuard, which is already included in Android Studio  or DexGuard can be used to strip out logging portions in the code when preparing the production release. For example, to remove logging calls within an android application, we can simply add the following option in the proguard-project.txt configuration file of Proguard:

```
-assumenosideeffects class android.util.Log
{
public static boolean isLoggable(java.lang.String, int);
public static int v(...);
public static int i(...);
public static int w(...);
public static int d(...);
public static int e(...);
}
```

Although the android:debuggable="" flag can be bypassed by repacking the application, before shipping it, it is important to set the option android:debuggable="false" in the AndroidManifest.xml


### References

 * Documentation for the Application tag: https://developer.android.com/guide/topics/manifest/application-element.html#allowbackup
 * Overview of Class Log - http://developer.android.com/reference/android/util/Log.html
 * Debugging Logs with LogCat - http://developer.android.com/tools/debugging/debugging-log.html


## <a name="OMTG-DATAST-009"></a>OMTG-DATAST-009: Test for Sensitive Data in Backups

### White-box Testing

In order to backup all your application’s data Android provides an attribute called allowBackup. This attribute is set within the AndroidManifest.xml file. If the value of this attribute is set to true then the device allows user to backup the application using Android Debug Bridge (ADB) - $adb backup. Note: If the device was encrypted then the backup files will be encrypted as well.

Check the AndroidManifest.xml file for the following flag:

```
android:allowBackup="true"
```

If the value is set to true, investigate whether the app saves any kind of sensitive data, either by reading the source code, or inspeciting the files in the app's data directory.

### Black-box Testing

Attempt to make a backup using adb and, if successful, inspect the backup archive for sensitive data. Open a terminal and run the following command:

```
$ adb backup -apk -nosystem packageNameOfTheDesiredAPK
```

Approve the backup from your device by selecting the "Back up my data" option. After the backup process is finished, you will have a .ab file in your current working directory.
Run the following command to convert the .ab file into a .tar file.

```
$ dd if=mybackup.ab bs=24 skip=1|openssl zlib -d > mybackup.tar
```

Extract the tar file into your current working directory to perform your analysis for sensitive data.

```
$ tar xvf mybackup.tar
```

### Remediation

To prevent backing up the app's data, set the android:allowBackup attribute must be set to false in AndroidManifest.xml.

### References

- Documentation for the Application tag: https://developer.android.com/guide/topics/manifest/application-element.html#allowbackup

