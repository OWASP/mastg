rules:
  - id: weak_crypto_key_generation
    severity: WARNING
    languages: 
      - swift
    metadata:
      summary: This rule looks for the common patterns including classes and methods that represent AES-128 bit alogrithm.
    message: >-
      The application appears to utilize a symmetric algorithm known as AES-128 with a weak key configuration, making it susceptible to multiple vulnerabilities and potential security breaches.
      AES keys should be at least 256 bits based on NIST recommendation.
    pattern-either:
      - patterns:
        - pattern-either:
          - pattern: kCCKeySizeAES128
      - patterns:
        - pattern-either:
          - pattern: |
              $KEY = SymmetricKey(size: $KEY_SIZE)
              ...
              $ENCRYPTED = try AES.GCM.seal($DATA, using: $KEY, ...)
          - pattern: |
              $KEY = SymmetricKey(size: $KEY_SIZE)
              ...
              $DATA = try AES.GCM.open($ENCRYPTED, using: $KEY)
        - focus-metavariable: $KEY
        - metavariable-pattern:
            metavariable: $KEY_SIZE
            patterns:
            - pattern-either:
              - pattern: .bits128
            - pattern-not: .bits256

